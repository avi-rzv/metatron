# Project Overview
This project will create operating system called MetatronOS that is fully controlled by AI (LLM).
The LLM will be connect via API and will levave in docker Linux VPS.

## 1. Architecture & Tech Stack

### High-Level Architecture

```
┌─────────────────────────────────────────────────────┐
│                    USER DEVICES                      │
│          Browser (PWA) / Mobile / Desktop            │
└──────────────────────┬──────────────────────────────┘
                       │ HTTPS (WebSocket + REST)
                       ▼
┌─────────────────────────────────────────────────────┐
│                 DOCKER CONTAINER                     │
│                                                     │
│  ┌────────────┐  ┌────────────┐  ┌────────────────┐│
│  │  Frontend  │  │  Backend   │  │  Shell Bridge  ││
│  │(React/Vite)│  │ (Fastify)  │  │  (PTY Manager) ││
│  └────────────┘  └─────┬──────┘  └───────┬────────┘│
│                      │                  │           │
│            ┌─────────┴─────────┐        │           │
│            │                   │        │           │
│       ┌────▼─────┐  ┌─────────▼──┐     │           │
│       │ Database │  │ LLM Router │     │           │
│       │ (SQLite) │  │            │     │           │
│       └──────────┘  └─────┬──────┘     │           │
│                           │             │           │
└───────────────────────────┼─────────────┼───────────┘
                            │             │
                   ┌────────▼──┐    ┌─────▼──────┐
                   │ LLM APIs  │    │ Host Shell │
                   │ (External)│    │  (via PTY) │
                   └───────────┘    └────────────┘
```

### Tech Stack

| Layer | Technology | Rationale |
|-------|-----------|-----------|
| **Frontend** | React 18 + Vite + Tailwind CSS | SPA — no SSR needed (single-user, behind auth). React has the most LLM training data of any framework. Vite provides fast HMR and zero-opinion bundling. Tailwind for rapid, consistent styling. |
| **Routing (client)** | React Router v6 | Well-established, heavily represented in LLM training data, straightforward API |
| **State (client)** | Zustand + TanStack Query | Zustand for UI state (lightweight, simple API). TanStack Query for server state (caching, refetching, loading states). |
| **Backend** | Node.js 20 LTS + Fastify | Persistent process (not serverless) — critical for WebSocket connections, PTY sessions, cron scheduler, and Pulse loop. Fastify has native WebSocket support, a plugin architecture that maps to Metatron's modules, and strong LLM training data coverage. |
| **Database** | SQLite (via better-sqlite3) | Zero-config, single-file, easily backed up, sufficient for single-user |
| **ORM** | Drizzle ORM | Type-safe, lightweight, good LLM support. Shared TypeScript types between frontend and backend. |
| **Realtime** | WebSockets (via @fastify/websocket) | Streaming LLM responses, live shell output, Pulse updates, command approvals |
| **Shell Bridge** | node-pty | Full PTY emulation, captures stdout/stderr, supports interactive programs |
| **Encryption** | AES-256-GCM (via Node crypto) | For API keys and sensitive memory entries |
| **Queue** | BullMQ + Redis (or in-process queue) | For scheduled tasks, Pulse cycles, agent pipeline jobs |
| **Containerization** | Docker + Docker Compose | Reproducible deployment, isolation, easy updates |
| **Language** | TypeScript everywhere | Shared types between frontend and backend in a monorepo |

### Why SPA, Not SSR

Metatron is a single-user system behind authentication. There are no public pages, no SEO requirements, and no unauthenticated visitors. Server-side rendering provides zero benefit here and adds significant complexity — particularly around client/server component boundaries, which are a common source of LLM-generated bugs. A Vite-built React SPA is simpler, faster to develop, and more reliably generated by LLMs. The Fastify backend serves the built SPA as static files in production.

### Why Single-User, Single-Container

Metatron is designed for **one user, one VPS**. This simplifies everything: no multi-tenancy, no user management, no RBAC beyond the owner. The entire system runs in a single Docker container (or a small Compose stack with Redis if using BullMQ), with a bind-mount to the host filesystem for shell access.